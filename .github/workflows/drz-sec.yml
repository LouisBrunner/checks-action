# THIS FILE WAS AUTOMATICALLY GENERATED BY DRIZLYINC/SCOUTER. DO NOT EDIT.
name: "Security Scans"
on:
  pull_request: {}
jobs:
  results:
    needs: "scans"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Download Artifact"
      uses: "actions/download-artifact@v3"
      with:
        name: "scan_results"
        path: "results/"
    - id: "results"
      name: "Check Scan Results"
      run: |
        results=$(cat results/*)
        nothing_found=$(echo -ne "--- TruffleHog Report ---\n--- TruffleHog Report ---")
        if [[ "$results" == "$nothing_found" ]]; then
          results=":tada: TruffleHog found no issues! :tada:"
        else
          results=$(echo -ne ":scream: TruffleHog found issues :scream:\n${results}")
        fi
        # multiline outputs require some tweaking:
        # https://github.com/orgs/community/discussions/26288#discussioncomment-3251220
        results="${results//'%'/'%25'}"
        results="${results//$'\n'/'%0A'}"
        results="${results//$'\r'/'%0D'}"
        echo "::set-output name=body::$results"
    - name: "Write results comment"
      uses: "peter-evans/create-or-update-comment@v2"
      with:
        body: "${{ steps.results.outputs.body }}"
        issue-number: "${{ github.event.pull_request.number }}"
  scans:
    secrets:
      gh_token: "${{ secrets.GITHUB_TOKEN }}"
    uses: "DrizlyInc/scouter/.github/workflows/drz-sec.yml@main"
    with:
      actor: "${{ github.actor }}"
